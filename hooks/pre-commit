#!/bin/bash

echo "ğŸ” Running linters..."

echo "ğŸ“ Formatting staged Swift files..."
git diff --diff-filter=d --staged --name-only | grep -e '\.swift$' | while read line; do
  if [[ $line == *"/Generated"* ]]; then
    echo "â­ï¸  Skipping generated file: $line"
  else
    echo "âœ¨ Formatting: $line"
    mise exec swiftformat -- swiftformat "${line}"
    git add "$line"
  fi
done

if ! mise run lint; then
    echo "âŒ Lint failed. Please fix the issues before committing."
    echo "ğŸ’¡ Tip: Run 'mise run format' to auto-fix some issues"
    echo "âš ï¸  To skip this hook, use: git commit --no-verify"
    exit 1
fi

echo "âœ… All checks passed!"
exit 0
